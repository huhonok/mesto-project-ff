(()=>{"use strict";var e={baseUrl:"https://nomoreparties.co/v1/wff-cohort-16",headers:{authorization:"7a9fad65-f5a1-4b93-8b42-2642fed3cafd","Content-Type":"application/json"}};function t(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))}var n=document.querySelector("#card-template").content;function o(e,t,o,r,c){var a=n.querySelector(".card").cloneNode(!0),i=a.querySelector(".card__image"),u=a.querySelector(".card__title"),s=a.querySelector(".card__delete-button"),l=a.querySelector(".card__like-button"),d=a.querySelector(".card__like-caption");return i.src=e.link,i.alt=e.name,d.textContent=e.likes.length,u.textContent=e.name,e.owner._id!==c?s.classList.add("card__delete-button-hidden"):s.addEventListener("click",(function(){return r(a,e)})),l.addEventListener("click",(function(){return t(l,d,e)})),i.addEventListener("click",(function(){return o(e)})),function(e,t){return e.some((function(e){return e._id===t}))}(e.likes,c)&&l.classList.toggle("card__like-button_is-active"),a}function r(n,o,r){var c=r._id;(n.classList.contains("card__like-button_is-active")?function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))}(c):function(n){return fetch("".concat(e.baseUrl,"/cards/likes/").concat(n),{method:"PUT",headers:e.headers}).then((function(e){return t(e)}))}(c)).then((function(e){o.textContent=e.likes.length,n.classList.toggle("card__like-button_is-active")}))}function c(e){"Escape"===e.key&&i(document.querySelector(".popup_is-opened"))}function a(e){e.classList.add("popup_is-animated"),setTimeout((function(){e.classList.add("popup_is-opened")}),1),document.addEventListener("keydown",c)}function i(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",c)}var u,s=function(e,t,n){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove(n.errorClass),o.textContent="",o.classList.remove(n.inputErrorClass)},l=function(e,t){e.classList.add(t.inactiveButtonClass),e.disabled=!0},d=function(e,t){Array.from(t.querySelectorAll(e.inputSelector)).forEach((function(n){return s(t,n,e)})),l(t.querySelector(e.submitButtonSelector),e)},f=document.querySelector(".places__list"),p=document.querySelector(".profile__image"),m=document.querySelector(".profile__edit-button"),_=document.querySelector(".profile__add-button"),h=document.querySelector(".edit__profile__image__button"),v=document.querySelector(".popup_type_edit"),y=document.querySelector(".popup_type_new-card"),b=document.querySelector(".popup_type_image"),S=document.querySelector(".popup_type_avatar_edit"),C=document.querySelector(".profile__title"),E=document.querySelector(".profile__description"),L=document.forms.edit_profile,q=document.forms.new_place,k=document.forms.update_avatar,g={formSelector:".popup__form",inputSelector:".popup__input",submitButtonSelector:".popup__button",inactiveButtonClass:"popup__button_disabled",inputErrorClass:"popup__input_type_error",errorClass:"popup__error_visible"};Promise.all([fetch("".concat(e.baseUrl,"/users/me"),{method:"GET",headers:e.headers}).then((function(e){return t(e)})),fetch("".concat(e.baseUrl,"/cards"),{method:"GET",headers:e.headers}).then((function(e){return t(e)}))]).then((function(e){var t=e[0];C.textContent=t.name,E.textContent=t.about,p.src=t.avatar,u=t._id,Array.from(e[1]).forEach((function(e){f.append(o(e,r,A,B,u))}))})).catch((function(e){console.log(e)}));var x=b.querySelector(".popup__image"),T=b.querySelector(".popup__caption");function A(e){x.src=e.link,x.alt=e.name,T.textContent=e.name,a(b)}function U(e){i(e),d(g,e)}function w(e){(e.target.classList.contains("popup_is-opened")||e.target.classList.contains("popup__close"))&&(U(e.currentTarget),q.reset())}function B(n,o){var r;(r=o._id,fetch("".concat(e.baseUrl,"/cards/").concat(r),{method:"DELETE",headers:e.headers}).then((function(e){return t(e)}))).then((function(e){n.remove()})).catch((function(e){console.log(e)}))}y.addEventListener("submit",(function(n){n.preventDefault();var c=q.elements.place_name.value,a=q.elements.link.value;n.submitter.textContent="Сохранение...",function(n,o){return fetch("".concat(e.baseUrl,"/cards"),{method:"POST",headers:e.headers,body:JSON.stringify({name:n,link:o})}).then((function(e){return t(e)}))}(c,a).then((function(e){f.prepend(o(e,r,A,B,u)),U(y),q.reset()})).catch((function(e){console.log(e)})).finally((function(){n.submitter.textContent="Сохранить"}))})),v.addEventListener("submit",(function(n){var o,r;n.preventDefault(),n.submitter.textContent="Сохранение...",(o=L.elements.name.value,r=L.elements.description.value,fetch("".concat(e.baseUrl,"/users/me"),{method:"PATCH",headers:e.headers,body:JSON.stringify({name:o,about:r})}).then((function(e){return t(e)}))).then((function(e){C.textContent=e.name,E.textContent=e.about,U(v)})).catch((function(e){console.log(e)})).finally((function(){n.submitter.textContent="Сохранить"}))})),S.addEventListener("submit",(function(n){var o;n.preventDefault(),n.submitter.textContent="Сохранение...",(o=k.elements.link.value,fetch("".concat(e.baseUrl,"/users/me/avatar"),{method:"PATCH",headers:e.headers,body:JSON.stringify({avatar:o})}).then((function(e){return t(e)}))).then((function(e){p.src=e.avatar,U(S)})).catch((function(e){console.log(e)})).finally((function(){n.submitter.textContent="Сохранить"})),k.reset()})),m.addEventListener("click",(function(){L.elements.name.value=C.textContent,L.elements.description.value=E.textContent,a(v)})),_.addEventListener("click",(function(){a(y)})),document.querySelectorAll(".popup").forEach((function(e){e.addEventListener("mousedown",w)})),h.addEventListener("click",(function(){a(S)})),function(e){Array.from(document.querySelectorAll(e.formSelector)).forEach((function(t){!function(e,t){var n=Array.from(e.querySelectorAll(t.inputSelector)),o=e.querySelector(t.submitButtonSelector);n.forEach((function(r){r.addEventListener("input",(function(){!function(e,t,n){var o;t.validity.patternMismatch?o=t.dataset.errorMessage:t.validity.valid||(o=t.validationMessage),o?function(e,t,n,o){var r=e.querySelector(".".concat(t.id,"-error"));t.classList.add(n.errorClass),r.textContent=o,r.classList.add(n.inputErrorClass)}(e,t,n,o):s(e,t,n)}(e,r,t),function(e,t,n){!function(e){return e.some((function(e){return!e.validity.valid}))}(t)?(e.classList.remove(n.inactiveButtonClass),e.disabled=!1):l(e,n)}(o,n,t)}))}))}(t,e)}))}(g)})();